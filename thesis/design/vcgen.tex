\subsection{VCGen with WP}
\label{subsec:vcgen_wp}

The predicates that can be generated by weakest precondition verification condition generation of Featherweight eBPF are essentially first-order logic, but extended with an \texttt{if-then-else} construct that can be seen as syntactic sugar for logical exclusive or. The predicates are defined by the grammar
\begin{figure}[H]
  \centering
  \begin{tabular}{lclr}
    $P$ & $::=$ & $ep$ & \\
                 & $|$ & $\neg P$ & (negation) \\    
                 & $|$ & $\forall v . P$ & (Universal quantifier) \\
                 & $|$ &  $P_1 \land P_2$ & (Logical conjunction) \\
                 & $|$ &  $P_1 \implies P_2$ & (Implication) \\
                 & $|$ &  \texttt{if} $ep$ \texttt{then} $P_1$ \texttt{else}  $P_2$ & (Logical exclusive or) \\        
\end{tabular}    
\end{figure}



The rules for WP computation are defined by


\[
  \mathrm{WP}(\mathcal{P}, idx, Q) =
  \begin{cases}
    \mathrm{true}, & \mathcal{P}_{idx} = \mathrm{exit} \\
    \forall v . v = p \implies \mathrm{WP}(\mathcal{P}, idx+1, Q)[x \leftarrow v])) , & \mathcal{P}_{idx} = x := p \\    
    \forall v . v = p_1 \oplus p_2 \implies \mathrm{WP}(\mathcal{P}, idx+1, Q)[x \leftarrow v])) , & \mathcal{P}_{idx} = x := p_1 \oplus p_2 \\
    \forall v . v = p_1 \otimes p_2 \implies \mathrm{WP}(\mathcal{P}, idx+1, Q)[x \leftarrow v])) , & \mathcal{P}_{idx} = x := p_1 \otimes p_2 \\    
    \forall v . (p_2  \neq 0 \land (v = p_1 \oslash p_2 \implies \mathrm{WP}(\mathcal{P}, idx+1, Q)[x \leftarrow v])) , & \mathcal{P}_{idx} = x := p_1 \oslash p_2 \\
    \forall v . v = p_1 ~ \mathrm{xor} ~ p_2 \implies \mathrm{WP}(\mathcal{P}, idx+1, Q)[x \leftarrow v])) , & \mathcal{P}_{idx} = x := p_1 ~ \mathrm{xor} ~ p_2 \\
    \mathrm{if} ~ p = e ~ \mathrm{then} ~ WP(\mathcal{P}, idx+1+\mathrm{off}, Q) ~ \mathrm{else} ~ WP(\mathcal{P},idx+1, Q) , & \mathcal{P}_{idx} = \mathrm{if} ~ p = e ~ \mathrm{then} ~ \mathrm{\mathrm{off}} \\
    \mathrm{if} ~ p \neq e ~ \mathrm{then} ~ WP(\mathcal{P}, idx+1+\mathrm{off}, Q) ~ \mathrm{else} ~ WP(\mathcal{P},idx+1, Q) , & \mathcal{P}_{idx} = \mathrm{if} ~ p \neq e ~ \mathrm{then} ~ \mathrm{\mathrm{off}} \\    
    \mathrm{if} ~ p \geq e ~ \mathrm{then} ~ WP(\mathcal{P}, idx+1+\mathrm{off}, Q) ~ \mathrm{else} ~ WP(\mathcal{P},idx+1, Q) , & \mathcal{P}_{idx} = \mathrm{if} ~ p \geq e ~ \mathrm{then} ~ \mathrm{\mathrm{off}} \\    \end{cases}
\]


